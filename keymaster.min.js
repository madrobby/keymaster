//     keymaster.js
//     (c) 2011 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.
(function(e){function u(e,t){var n=e.length;while(n--)if(e[n]===t)return n;return-1}function a(e,t){var i,o,a,f,l;i=e.keyCode;if(i==93||i==224)i=91;if(i in r){r[i]=!0;for(a in s)s[a]==i&&(c[a]=!0);return}if(!c.filter.call(this,e))return;if(!(i in n))return;for(f=0;f<n[i].length;f++){o=n[i][f];if(o.scope==t||o.scope=="all"){l=o.mods.length>0;for(a in r)if(!r[a]&&u(o.mods,+a)>-1||r[a]&&u(o.mods,+a)==-1)l=!1;(o.mods.length==0&&!r[16]&&!r[18]&&!r[17]&&!r[91]||l)&&o.method(e,o)===!1&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0))}}}function f(e){var t=e.keyCode,n;if(t==93||t==224)t=91;if(t in r){r[t]=!1;for(n in s)s[n]==t&&(c[n]=!1)}}function l(){for(t in r)r[t]=!1;for(t in s)c[t]=!1}function c(e,t,r){var i,u,a,f,l;r===undefined&&(r=t,t="all"),e=e.replace(/\s/g,""),i=e.split(","),i[i.length-1]==""&&(i[i.length-2]+=",");for(a=0;a<i.length;a++){u=[],e=i[a].split("+");if(e.length>1){u=e.slice(0,e.length-1);for(f=0;f<u.length;f++)u[f]=s[u[f]];e=[e[e.length-1]]}e=e[0],e=o[e]||e.toUpperCase().charCodeAt(0),e in n||(n[e]=[]),l=t.replace(/\s/g,"").split(",");for(j=0;j<l.length;j++)t=l[j],n[e].push({shortcut:i[a],scope:t,method:r,key:i[a],mods:u})}}function h(e){var t=(e.target||e.srcElement).tagName;return t!="INPUT"&&t!="SELECT"&&t!="TEXTAREA"}function p(e){i=e||"all"}function d(){return i||"all"}function v(e){var t,r,i;for(t in n){r=n[t];for(i=0;i<r.length;)r[i].scope===e?r.splice(i,1):i++}}function m(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,function(){n(window.event)})}var t,n={},r={16:!1,18:!1,17:!1,91:!1},i="all",s={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,command:91},o={backspace:8,tab:9,clear:12,enter:13,"return":13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,"delete":46,home:36,end:35,pageup:33,pagedown:34,",":188,".":190,"/":191,"`":192,"-":189,"=":187,";":186,"'":222,"[":219,"]":221,"\\":220};for(t=1;t<20;t++)s["f"+t]=111+t;for(t in s)c[t]=!1;m(document,"keydown",function(e){a(e,i)}),m(document,"keyup",f),m(window,"focus",l),e.key=c,e.key.setScope=p,e.key.getScope=d,e.key.deleteScope=v,e.key.filter=h,typeof module!="undefined"&&(module.exports=key)})(this)