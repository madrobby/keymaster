//     keymaster.js
//     (c) 2011 Thomas Fuchs
//     keymaster.js may be freely distributed under the MIT license.
(function(a){function k(a,b,c){if(a.attachEvent){a["e"+b+c]=c;a[b+c]=function(){a["e"+b+c](window.event)};a.attachEvent("on"+b,a[b+c])}else a.addEventListener(b,c,false)}function j(a){d=a||"all"}function i(a,c,d){var g,h;if(d===undefined){d=c;c="all"}a=a.replace(/\s/g,"");g=a.split(",");for(var i=0,j=g.length;i<j;i++){h=[];a=g[i].split("+");if(a.length>1){h=a.slice(0,a.length-1);for(var k=0,l=h.length;k<l;k++)h[k]=e[h[k]];a=[a[a.length-1]]}a=a[0];a=a.length>1?f[a]:a.toUpperCase().charCodeAt(0);if(!(a in b))b[a]=[];b[a].push({scope:c,method:d,key:g[i],mods:h})}}function h(a){var b=a.keyCode;if(b in c)c[b]=false}function g(a){var e,f;f=(a.target||a.srcElement).tagName;e=a.keyCode;if(e in c)return c[e]=true;if(f=="INPUT"||f=="SELECT"||f=="TEXTAREA")return;if(!(e in b))return;for(var g=0,h=b[e].length;g<h;g++){var i=b[e][g];if(i.scope==d||i.scope=="all"){var j=i.mods.length>0&&function(){for(var a=0,b=i.mods.length;a<b;a++)if(!c[i.mods[a]])return false;return true}();if(i.mods.length==0&&!c[16]&&!c[18]&&!c[17]&&!c[91]||j){if(i.method(a,i.key,i.scope)===false){if(a.stopPropigation)a.stopPropagation();else if(a.cancelBubble)a.cancelBubble();if(a.preventDefault)a.preventDefault();else a.returnValue=false}}}}}var b={},c={16:false,18:false,17:false,91:false},d="all",e={shift:16,option:18,"⌥":18,alt:18,ctrl:17,control:17,command:91,"⌘":91},f={backspace:8,tab:9,enter:13,"return":13,escape:27,space:32,left:37,up:38,right:39,down:40};k(document,"keydown",g);k(document,"keyup",h);a.key=i;a.keyScope=j})(this)